@startuml
actor User
skinparam dpi 200
skinparam maxMessageSize 200
skinparam maxWidth 4096
skinparam maxHeight 4096

actor User
participant PaymentController
participant PaymentService
participant PaymentMapper
participant OrderItemService
participant OrderItemMapper
participant FileHelper
database Database

User -> PaymentController : GET /mypage/shopping/order
PaymentController -> PaymentService : getList(Payment paymentInput)
PaymentService -> PaymentMapper : selectList(Payment paymentInput)
PaymentMapper -> Database : SELECT * FROM payments WHERE member_id = #{memberId} ORDER BY order_no DESC
Database --> PaymentMapper : ResultSet
PaymentMapper --> PaymentService : List<Payment>
PaymentService --> PaymentController : List<Payment>

loop for each payment in payments
    PaymentController -> OrderItemService : getList(OrderItem orderItemInput)
    OrderItemService -> OrderItemMapper : selectList(OrderItem orderItemInput)
    OrderItemMapper -> Database : SELECT * FROM order_items WHERE payment_id = #{paymentId}
    Database --> OrderItemMapper : ResultSet
    OrderItemMapper --> OrderItemService : List<OrderItem>
    OrderItemService --> PaymentController : List<OrderItem>

    loop for each item in items
        PaymentController -> FileHelper : getUrl(String orderImg)
        FileHelper --> PaymentController : String
    end
end

PaymentController -> Model : addAttribute("payments", payments)
PaymentController -> User : return "mypage/shopping/order"

@enduml